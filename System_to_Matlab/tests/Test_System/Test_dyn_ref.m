function [xdot] = Test_dyn(x, u, params) 
	q1 = x(1);
	q2 = x(2);
	q3 = x(3);
	q1dot = x(4);
	q2dot = x(5);
	q3dot = x(6);
	M1 = u(1);
	M2 = u(2);
	M3 = u(3);
	g = params(1);
	m2 = params(2);
	m3 = params(3);
	s2 = params(4);
	s3 = params(5);
	l2 = params(6);
	l3 = params(7);
	BS1 = params(8);
	AS2 = params(9);
	BS2 = params(10);
	CS2 = params(11);
	AS3 = params(12);
	BS3 = params(13);
	CS3 = params(14);
	iG1 = params(15);
	iG2 = params(16);
	iG3 = params(17);
	BM1 = params(18);
	CM2 = params(19);
	CM3 = params(20);
	x0 = 2*q1dot;
	x1 = cos(q3);
	x2 = sin(q3);
	x3 = x1.*x2;
	x4 = q3dot.*x3;
	x5 = x0.*x4;
	x6 = sin(q2);
	x7 = cos(q2);
	x8 = x6.*x7;
	x9 = q2dot.*x8;
	x10 = x0.*x9;
	x11 = sin(q1);
	x12 = x11.^4;
	x13 = m3.*x12;
	x14 = x1.^3;
	x15 = x14.*x2;
	x16 = s3.^2;
	x17 = q1dot.*x16;
	x18 = q3dot.*x17;
	x19 = x15.*x18;
	x20 = x1.^2;
	x21 = l2.^2;
	x22 = x20.*x21;
	x23 = q1dot.*x9;
	x24 = x22.*x23;
	x25 = m2.*s2.^2;
	x26 = l2.*x7;
	x27 = x2.^2;
	x28 = s3.*x27;
	x29 = x1.*x28;
	x30 = x26.*x29;
	x31 = q1dot.*x13;
	x32 = q2dot.*x31;
	x33 = cos(q1);
	x34 = x33.^2;
	x35 = x1.*x34;
	x36 = x11.^2;
	x37 = m3.*x36;
	x38 = x0.*x37;
	x39 = q3dot.*x38;
	x40 = x16.*x39;
	x41 = x2.^3;
	x42 = x35.*x41;
	x43 = l2.*x6;
	x44 = s3.*x41.*x43;
	x45 = q3dot.*x44;
	x46 = x33.^4;
	x47 = m3.*x46;
	x48 = q1dot.*x47;
	x49 = x21.*x27;
	x50 = x10.*x34.*x37;
	x51 = x1.*x41;
	x52 = x18.*x51;
	x53 = s3.*x1;
	x54 = x26.*x53;
	x55 = s3.*x20;
	x56 = x2.*x43;
	x57 = x55.*x56;
	x58 = x34.*x39;
	x59 = m3.*q2dot.*x0;
	x60 = x28.*x36;
	x61 = x26.*x35;
	x62 = x60.*x61;
	x63 = s3.*x14;
	x64 = x26.*x63;
	x65 = x12.*x64;
	x66 = q1dot.*q2dot;
	x67 = x2.*x34;
	x68 = x14.*x67;
	x69 = x23.*x49;
	x70 = x26.*x36;
	x71 = x34.*x70;
	x72 = x63.*x71;
	x73 = s3.*x56;
	x74 = q3dot.*x48;
	x75 = x21.*x23;
	x76 = x47.*x66;
	x77 = x17.*x4;
	x78 = q3dot.*x31;
	x79 = -AS2.*x10 + AS3.*x5 + BS2.*x10 - BS3.*x5 - M1.*iG1 + m3.*x65.*x66 + x10.*x25 - x13.*x19 + x13.*x24 - x13.*x52 + x13.*x69 + x13.*x75 - x13.*x77 - x19.*x47 - x2.*x35.*x40 + x21.*x50 + x22.*x50 + x24.*x47 + x30.*x32 + x30.*x76 - x31.*x45 + x32.*x54 - x34.*x38.*x45 - x40.*x42 - x40.*x68 - x45.*x48 - x47.*x52 + x47.*x69 + x47.*x75 - x47.*x77 + x49.*x50 + x53.*x59.*x71 + x54.*x76 - x57.*x58 - x57.*x74 - x57.*x78 - x58.*x73 + x59.*x62 + x59.*x72 + x64.*x76 - x73.*x74 - x73.*x78;
	x80 = -x1.*x43 - x2.*x70 - x26.*x67;
	x81 = x1.*x33;
	x82 = s3.*x81 + x33.*x43;
	x83 = x11.*x82;
	x84 = -x11.*x43 - x11.*x53;
	x85 = -x2.*x33.*x84 - x2.*x83;
	x86 = m3.*x85;
	x87 = x1.*x83 + x81.*x84;
	x88 = x1.*x70 - x56 + x61;
	x89 = m3.*x88;
	x90 = x80.*x86 + x87.*x89;
	x91 = x6.^2;
	x92 = 1./(AS2.*x7.^2 + AS3.*x27 + BM1.*iG1.^2 + BS1 + BS2.*x91 + BS3.*x20 + m3.*x85.^2 + m3.*x87.^2 + m3.*(-x11.*x84 + x33.*x82).^2 + x25.*x91);
	x93 = x90.*x92;
	x94 = x2.*x53;
	x95 = -x34.*x94 - x36.*x94 + x94;
	x96 = x28.*x34 + x55 + x60;
	x97 = m3.*x87.*x95 + x86.*x96;
	x98 = m3.*x80.*x96 + x89.*x95 - x93.*x97;
	x99 = 1./(CM2.*iG2.^2 + CS2 + m3.*x80.^2 + m3.*x88.^2 + x25 - x90.^2.*x92);
	x100 = x98.^2.*x99;
	x101 = 1./(CM3.*iG3.^2 + CS3 + m3.*x95.^2 + m3.*x96.^2 - x100 - x92.*x97.^2);
	x102 = x98.*x99;
	x103 = x102.*x93 - x92.*x97;
	x104 = x101.*x103;
	x105 = -x104.*x98 - x93;
	x106 = x90.*x99;
	x107 = x101.*x97;
	x108 = x100.*x101 + 1;
	x109 = q1dot.^2;
	x110 = x109.*x8;
	x111 = m3.*q3dot.^2;
	x112 = 2*x36;
	x113 = x112.*x34;
	x114 = m3.*x110.*x113;
	x115 = m3.*q2dot.^2;
	x116 = x115.*x8;
	x117 = x116.*x49;
	x118 = m3.*x109;
	x119 = x118.*x46;
	x120 = x110.*x13;
	x121 = x111.*x46;
	x122 = x116.*x22;
	x123 = 2*x118;
	x124 = g.*m3;
	x125 = x124.*x43;
	x126 = x110.*x47;
	x127 = 2*x111;
	x128 = x118.*x12;
	x129 = AS2.*x110 - BS2.*x110 - M2.*iG2 - g.*m2.*s2.*x6 - x110.*x25 - x111.*x12.*x30 + x111.*x44 + x111.*x57 - x111.*x65 - x113.*x117 - x113.*x122 - x114.*x22 - x114.*x49 - x117.*x12 - x117.*x46 + x117 - x118.*x65 - x119.*x30 - x119.*x64 - x12.*x122 - x120.*x22 - x120.*x49 - x121.*x30 - x121.*x64 - x122.*x46 + x122 - x123.*x62 - x123.*x72 - x125.*x20 - x125.*x27 - x126.*x22 - x126.*x49 - x127.*x62 - x127.*x72 - x128.*x30;
	x130 = x118.*x16;
	x131 = x130.*x46;
	x132 = x109.*x3;
	x133 = x111.*x16;
	x134 = x133.*x15;
	x135 = x115.*x57;
	x136 = x115.*x44;
	x137 = x133.*x51;
	x138 = x112.*x133;
	x139 = x113.*x118;
	x140 = x112.*x130;
	x141 = x12.*x130;
	x142 = -AS3.*x132 + BS3.*x132 - M3.*iG3 + x113.*x135 + x113.*x136 - x115.*x30 - x115.*x64 + x119.*x44 + x119.*x57 + x12.*x134 + x12.*x135 + x12.*x136 + x12.*x137 + x124.*x29 + x124.*x63 + x128.*x44 + x128.*x57 + x131.*x15 + x131.*x51 + x134.*x46 - x134 + x135.*x46 + x136.*x46 + x137.*x46 - x137 + x138.*x42 + x138.*x68 + x139.*x44 + x139.*x57 + x140.*x42 + x140.*x68 + x141.*x15 + x141.*x51;
	x143 = x101.*x98;
	x144 = x101.*x142;
	x145 = x129.*x99;

	xdot = [q1dot; q2dot; q3dot; -x129.*x92.*(x102.*x107 - x106.*x108) - x142.*x92.*(x106.*x143 - x107) - x79.*x92.*(-x103.*x107 - x105.*x106 + 1); x102.*x144 - x105.*x79.*x99 - x108.*x145; -x104.*x79 + x143.*x145 - x144];
end